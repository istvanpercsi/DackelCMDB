openapi: 3.0.1
info:
  title: Dackel CMDB
  version: 1.0.0
  description: It is an API for Dackel CMDB. (Configruation Management DataBase) It is a lightweight Database, where you
    can store entities and properties, and their connections.
tags:
  - name: entities
    description: Get entities, crate new entity, update entity
  - name: properties
    description: Get properties, create a new property, delete property

paths:
  /entities:
    get:
      operationId: getListOfEntities
      summary: Get the list of entiies
      description: Get list of entities. If there is no parameter defined, then it retunrs the last 20 element.
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            format: int64
          description: Page of the result list
        - name: size
          in: query
          schema:
            type: integer
            format: int64
          description: Size of the page of the result list
        - name: filter
          in: query
          schema:
            type: string
          description: Filtered the name of the entity. Magic character * can be used
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/listOfSimpleEntities'
          description: Retunrs list of entities (id and name of entiy
        500:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Internal server error happened. Details in error message.
      tags:
        - entities
  /entity:
    post:
      operationId: saveEntity
      summary: Save an entity with the given name
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/simpleEntityRequest'
      responses:
        201:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/extendedEntityResponse'
          description: Returns the saved entity with the given name.
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Bad request, it can happen, if the name of the entity is null. Details can be found in error message
        409:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Bad request, it can happen, if the name of the entity is the same as an another entity, which is already saved.
        500:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Internal server error. if there is some technical problem with saving of data.
      tags:
        - entities
  /entity/{uuid}:
    get:
      operationId: getEntity
      summary: Get an entity and its metadata.
      description: Get an Entity. It returns with the entity metadata (name, uuid, create date, last modified date, list of properties, etc)
      parameters:
        - name: uuid
          in: path
          schema:
            type: string
            format: uuid
          required: true
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/extendedEntityResponse'
          description: Returns an Entity with all of the informations, as well as meta infos, added properties, etc.
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Entity not found error. If the id of entity does not exist
        500:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Internal server error. If there some error happened during the query of the entity. Details in error.
      tags:
        - entities
    put:
      operationId: updateEntity
      summary: Update the name of the entity
      parameters:
        - name: uuid
          in: path
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/simpleEntityRequest'
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/extendedEntityResponse'
          description: Returns the updated entity
      tags:
        - entities
  /entity/{uuid}/properties:
    get:
      operationId: getPropertiesOfEntity
      summary: Get the properties of entity.
      parameters:
        - name: uuid
          in: path
          schema:
            type: string
            format: uuid
          required: false
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/listOfSimpleEntities'
          description: Returns the list of properties
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Not found, if the entity is not found in database.
        500:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
          description: Internal server error, if something wrong happened :)
      tags:
        - entities
  /entity/{uuid}/property:
    post:
      operationId: savePropertyOfEntity
      responses:
        200:
          description: Returns with the saved property
      tags:
        - entities
  /entity/{uuidOfEntity}/property/{uuidOfProperty}:
    get:
      responses:
        200:
          description: Returns the value of Property
      tags:
        - entities
    put:
      responses:
        200:
          description: Returns with the updated property
      tags:
        - entities
  /properties:
    get:
      operationId: getProperties
      summary: List of valid properties
      responses:
        200:
          description: Returns the list of saved property types
      tags:
        - properties
  /property:
    get:
      operationId: getProperty
      summary: Get property and its metadata
      responses:
        200:
          description: Returns with the selected property
      tags:
        - properties
    post:
      operationId: saveProperty
      summary: Save a new property
      responses:
        200:
          description: Returns the saved new property
      tags:
        - properties
    put:
      operationId: updateProperty
      summary: Update property
      responses:
        200:
          description: Returns the updated property
      tags:
        - properties
components:
  schemas:
    extendedEntityResponse:
      type: object
      properties:
        id:
          type: string
          format: 'uuid'
        name:
          type: string
          example: "Name of the Entity"
        createDate:
          $ref: '#/components/schemas/date'
        modifyDate:
          $ref: '#/components/schemas/date'
        creator:
          $ref: '#/components/schemas/user'
        modifier:
          $ref: '#/components/schemas/user'
    simpleEntityResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Name of the entity"
    simpleEntityRequest:
      type: object
      properties:
        name:
          type: string
          example: "Name of entity"
    listOfSimpleEntities:
      type: object
      properties:
        entities:
          type: array
          items:
            $ref: '#/components/schemas/simpleEntityResponse'
    extendedPropertyResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Name of property"
        type:
          $ref: '#/components/schemas/typeOfProperty'
        multiplicity:
          $ref: '#/components/schemas/multiplicityOfProperty'
        format:
          type: string
          example: format of display -> java text format
        createDate:
          $ref: '#/components/schemas/date'
        modifyDate:
          $ref: '#/components/schemas/date'
        creator:
          $ref: '#/components/schemas/user'
        modifier:
          $ref: '#/components/schemas/user'
    simplePropertyRequest:
      type: object
      properties:
        name:
          type: string
          example: "Name of property"
        type:
          $ref: '#/components/schemas/typeOfProperty'
        multiplicity:
          $ref: '#/components/schemas/multiplicityOfProperty'
        format:
          type: string
          example: format of display -> java text format
    simplePropertyResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Name of property"
    listOfSimplePropertyResponse:
      type: object
      properties:
        properties:
          type: array
          items:
            $ref: '#/components/schemas/simplePropertyResponse'
    extendedPropertyValueResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        property:
          $ref: '#/components/schemas/simplePropertyResponse'
        value:
          type: string
        createDate:
          $ref: '#/components/schemas/date'
        modifyDate:
          $ref: '#/components/schemas/date'
        creator:
          $ref: '#/components/schemas/user'
        modifier:
          $ref: '#/components/schemas/user'
    simplePropertyValueRequest:
      type: object
      properties:
        value:
          type: string
    simplePropertyValueResponse:
      properties:
        id:
          type: string
          format: uuid
        property:
          type: string
        value:
          type: string
    error:
      type: object
      properties:
        errorType:
          $ref: '#/components/schemas/errorTypesEnum'
        code:
          type: string
        message:
          type: string

# simple types
    date:
      type: string
      format: 'date-time'
      example: "yyyy-MM-dd'T'HH:mm:ss.SSSXXX — for example, '2000-10-31T01:30:00.000-05:00'"
    user:
      type: string
    typeOfProperty:
      type: string
      enum: [ STRING, SECRET, TEXT, NUMBER ]
    multiplicityOfProperty:
      type: string
      enum: [ SINGLE, MULTI ]
    errorTypesEnum:
      type: string
      enum: [BUSINESS, TECHNICAL, INTERNAL]
